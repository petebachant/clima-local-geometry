stages:
  analyze-local-geometry-impact:
    cmd: calkit xenv -n main --no-check -- 
      "scripts/analysis_local_geometry_impact.jl"
    deps:
      - scripts/analysis_local_geometry_impact.jl
      - .calkit/envs/main/Manifest.toml
    outs:
      - results/analysis_local_geometry_impact.md:
          cache: false
          persist: false
    desc: Automatically generated from the 
      'analyze-local-geometry-impact' stage in calkit.yaml. Changes 
      made here will be overwritten.
  benchmark-local-geometry-impact:
    cmd: calkit slurm batch --name benchmark-local-geometry-impact 
      --environment clima --dep 
      scripts/benchmark_local_geometry_impact.jl --dep 
      ClimaCore.jl/.buildkite/Manifest.toml --dep ClimaCore.jl/src 
      --dep ClimaCore.jl/ext --out 
      results/benchmark_local_geometry_impact.md -s --gpus=1 -s 
      --time=30 -- scripts/run_benchmark_slurm.sh
    deps:
      - scripts/run_benchmark_slurm.sh
      - scripts/benchmark_local_geometry_impact.jl
      - ClimaCore.jl/.buildkite/Manifest.toml
      - ClimaCore.jl/src
      - ClimaCore.jl/ext
    outs:
      - results/benchmark_local_geometry_impact.md:
          cache: false
          persist: true
      - .calkit/slurm/logs/benchmark-local-geometry-impact.out:
          cache: false
          persist: true
    desc: Automatically generated from the 
      'benchmark-local-geometry-impact' stage in calkit.yaml. Changes 
      made here will be overwritten.
  amip-baseline:
    cmd: calkit slurm batch --name amip-baseline --environment clima 
      --dep config/climaatmos_progedmf_1m.yml --dep 
      scripts/run_progedmf_1m.jl --dep 
      ClimaAtmos.jl/.buildkite/Manifest-v1.11.toml --dep 
      ClimaAtmos.jl/src -s --gpus=1 -s --time=120 -- 
      scripts/run-julia-script.sh --project=ClimaAtmos.jl/.buildkite 
      scripts/run_progedmf_1m.jl
    deps:
      - scripts/run-julia-script.sh
      - config/climaatmos_progedmf_1m.yml
      - scripts/run_progedmf_1m.jl
      - ClimaAtmos.jl/.buildkite/Manifest-v1.11.toml
      - ClimaAtmos.jl/src
    outs:
      - .calkit/slurm/logs/amip-baseline.out:
          cache: false
          persist: true
    desc: Automatically generated from the 'amip-baseline' stage in 
      calkit.yaml. Changes made here will be overwritten.
  amip-mod:
    cmd: calkit slurm batch --name amip-mod --environment clima --dep 
      config/climaatmos_progedmf_1m.yml --dep 
      scripts/run_progedmf_1m.jl --dep 
      ClimaAtmos.jl-mod/.buildkite/Manifest-v1.11.toml --dep 
      ClimaAtmos.jl-mod/src -s --gpus=1 -s --time=120 -- 
      scripts/run-julia-script.sh 
      --project=ClimaAtmos.jl-mod/.buildkite 
      scripts/run_progedmf_1m.jl
    deps:
      - scripts/run-julia-script.sh
      - config/climaatmos_progedmf_1m.yml
      - scripts/run_progedmf_1m.jl
      - ClimaAtmos.jl-mod/.buildkite/Manifest-v1.11.toml
      - ClimaAtmos.jl-mod/src
    outs:
      - .calkit/slurm/logs/amip-mod.out:
          cache: false
          persist: true
    desc: Automatically generated from the 'amip-mod' stage in 
      calkit.yaml. Changes made here will be overwritten.
  analyze-logs:
    cmd: calkit nb execute --environment py --no-check --to html 
      "notebooks/analyze-logs.ipynb"
    deps:
      - .calkit/notebooks/cleaned/notebooks/analyze-logs.ipynb
      - .calkit/envs/py/uv.lock
      - .calkit/slurm/logs/amip-baseline.out
      - .calkit/slurm/logs/amip-mod.out
    outs:
      - figures/sypd-time-series.png:
          cache: false
          persist: false
      - .calkit/notebooks/executed/notebooks/analyze-logs.ipynb:
          cache: false
      - .calkit/notebooks/html/notebooks/analyze-logs.html:
          cache: false
    desc: Automatically generated from the 'analyze-logs' stage in 
      calkit.yaml. Changes made here will be overwritten.
  nsys-baseline:
    cmd: calkit slurm batch --name nsys-baseline --environment clima 
      --dep ClimaAtmos.jl/.buildkite/Manifest-v1.11.toml --dep 
      ClimaAtmos.jl/src --dep config/climaatmos_progedmf_1m.yml --dep 
      ClimaAtmos.jl/perf/benchmark_step.jl --out 
      results/nsys/baseline.nsys-rep --out 
      results/nsys/baseline.sqlite -s --gpus=1 -s --time=120 -- 
      scripts/run-nsys.sh --output=results/nsys/baseline julia 
      --project=ClimaAtmos.jl/.buildkite 
      ClimaAtmos.jl/perf/benchmark_step.jl 
      --config_file=config/climaatmos_progedmf_1m.yml
    deps:
      - scripts/run-nsys.sh
      - ClimaAtmos.jl/.buildkite/Manifest-v1.11.toml
      - ClimaAtmos.jl/src
      - config/climaatmos_progedmf_1m.yml
      - ClimaAtmos.jl/perf/benchmark_step.jl
    outs:
      - results/nsys/baseline.nsys-rep:
          cache: true
          persist: true
      - results/nsys/baseline.sqlite:
          cache: true
          persist: true
      - .calkit/slurm/logs/nsys-baseline.out:
          cache: false
          persist: true
    desc: Automatically generated from the 'nsys-baseline' stage in 
      calkit.yaml. Changes made here will be overwritten.
  nsys-mod:
    cmd: calkit slurm batch --name nsys-mod --environment clima --dep 
      ClimaAtmos.jl-mod/.buildkite/Manifest-v1.11.toml --dep 
      ClimaAtmos.jl-mod/src --dep config/climaatmos_progedmf_1m.yml 
      --dep ClimaAtmos.jl-mod/perf/benchmark_step.jl --out 
      results/nsys/mod.nsys-rep --out results/nsys/mod.sqlite -s 
      --gpus=1 -s --time=120 -- scripts/run-nsys.sh 
      --output=results/nsys/mod julia 
      --project=ClimaAtmos.jl-mod/.buildkite 
      ClimaAtmos.jl-mod/perf/benchmark_step.jl 
      --config_file=config/climaatmos_progedmf_1m.yml
    deps:
      - scripts/run-nsys.sh
      - ClimaAtmos.jl-mod/.buildkite/Manifest-v1.11.toml
      - ClimaAtmos.jl-mod/src
      - config/climaatmos_progedmf_1m.yml
      - ClimaAtmos.jl-mod/perf/benchmark_step.jl
    outs:
      - results/nsys/mod.nsys-rep:
          cache: true
          persist: true
      - results/nsys/mod.sqlite:
          cache: true
          persist: true
      - .calkit/slurm/logs/nsys-mod.out:
          cache: false
          persist: true
    desc: Automatically generated from the 'nsys-mod' stage in 
      calkit.yaml. Changes made here will be overwritten.
